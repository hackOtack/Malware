#include <iostream>
#include <sstream>
#include <string>
#include <fstream>



__int64 (calculate_hash)(char* , __int64);
int main()
{

    std::ifstream file("c:\\users\\malware\\desktop\\dlls.txt");
    if (file.is_open()) {
        std::string line;
        while (std::getline(file, line)) {
            // for calculating hash of dlls we pass 0 as the second argument 
            int res = calculate_hash((char*)const_cast<char*>(line.c_str()), 0);
            //std::cout << line  << " ---> hex_val:" << std::hex << res << "\n";
            if (res == 233352 ) { // decimal value corresponding to the first dll loaded by shellcode
                std::cout << line << " ---> hex_val:" << std::hex << res << "\n"; // user32.dll
            }
        }
        file.close();
    }

      

}


__int64 calculate_hash(char* a1, __int64 a2)
{
    __int64 v2; 
    v2 = 0i64;
    while (*a1)
    {
        v2 = 2i64 * ((*a1++ | 0x60) + (unsigned int)v2);
        if (a2)
            ++a1;
    }
    return v2;
}

