#This plugin extracts all hardcoded encrypted strings 


import re
wf_addr = idc.get_name_ea_simple("prep_string")
#print(hex(wf_addr), idc.generate_disasm_line(wf_addr, 0))

for addr_call in idautils.CodeRefsTo(wf_addr, 0):
    prev = prev_head(addr_call, minea=0)
    ea = prev_head(prev, minea=0)
    
    
    #print string value    
    if(idc.get_operand_type(ea, 0) ==1):
        string_add = idc.get_operand_value(ea, 1)
        string_offset = hex(idc.get_operand_value(ea, 1))[:-1]
        bytes = ida_bytes.get_strlit_contents(idc.get_operand_value(ea, 1), ida_bytes.get_item_size(idc.get_operand_value(ea, 1)), ida_nalt.STRTYPE_C_16)
        if(bytes):
            print(string_offset, bytes)
