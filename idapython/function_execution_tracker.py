#function execution tracker from reverse-engineer.net/hexorcism 
import idaapi
import idautils
import idc
def bp_del(address):
    idaapi.del_bpt(address)
#color function when bp is hit 
def color_func(function):
    idc.set_color(function, CIC_FUNC, 0x5FDFC6)
    bp_del(function)
def bp(address, condition): 
    idaapi.add_bpt(address, 4, BPT_DEFAULT); 
    bpt = idaapi.bpt_t();
    idaapi.get_bpt(address, bpt);
    bpt.elang = 'Python'; 
    bpt.condition = condition; 
    idaapi.update_bpt(bpt); 
#set a bp on each function 
def bp_function():
    for function in idautils.Functions():
       # print(hex(function))
       bp(function, 'color_func(' + str(function) + ')')
#clean everything after trace    
def clean():
    for function in idautils.Functions():
        idc.set_color(function, CIC_FUNC, 0xFFFFFFFF)  
        bp_del(function)
bp_function()
